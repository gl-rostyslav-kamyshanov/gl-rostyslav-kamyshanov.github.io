import{d as y,u as A,M as k,P as z,b as E,r as m,f as P,q as R,K as S,o as L,c as f,a as i,s as w,z as N,j as c,i as B,a6 as M,bP as C,bQ as F,ay as I,az as q,bR as O}from"./D1PGu32k.js";const j={class:"main-container text-main flex justify-center items-center gap-4"},T={key:0,class:"inline-block h-8 w-8 animate-spin rounded-full border-2 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},J=y({__name:"[provider]",setup(V){const{t:h,te:_}=A(),u=k(),d=z(),v=E(),l=u.query.code,t=u.params.provider,r=m(null),n=m(!1),p=P(()=>r.value&&R(r.value.message,{t:h,te:_}).message),g=S().public.APP_FLAGS.deviceLimitNewFlow,s=e=>{window.opener&&window.opener.postMessage(e,window.opener.location)},a=e=>{if(!window.opener){e.code&&e.code==="device_limit_exceeded"&&(g?(v.logout(),d.push({path:"/auth/login/",query:{deviceNoLongerAllowedError:"true"}})):q(e.token,e.provider)),r.value=e;return}s({error:JSON.stringify(e)})},b=e=>{if(O(e,t),!window.opener){d.push("/");return}s({success:!0})};return L(async()=>{if(n.value=!0,!l||!t){const e=new Error("Invalid authorization code or provider");a(e);return}try{const{access_token:e}=await C(l);if(window.opener){s({access_token:e});return}const o=F(e,t);I.signSSO(o).then(b).catch(a)}catch(e){a(e)}finally{n.value=!1}}),(e,o)=>{const x=M;return i(),f("div",j,[c(n)?(i(),f("div",T,o[0]||(o[0]=[B("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},null,-1)]))):w("",!0),c(p)?(i(),N(x,{key:1,type:"danger",text:c(p)},null,8,["text"])):w("",!0)])}}});export{J as default};
