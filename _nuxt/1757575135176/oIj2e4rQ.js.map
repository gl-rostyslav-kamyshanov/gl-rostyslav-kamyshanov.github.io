{"version":3,"file":"oIj2e4rQ.js","sources":["../../../../app/composables/use-sso-login.ts"],"sourcesContent":["import useAsync from \"~/composables/use-async\";\nimport AuthAPI from \"~/services/auth\";\nimport useUserStore from \"~/stores/user\";\nimport { onDeviceLimitError } from \"~/utils/device\";\nimport getErrorLocalePathMessage from \"~/utils/locale\";\n\nexport default function useSSOLogin(options?: { onSuccess?: () => void; onError?: (error: Error) => void }) {\n  const router = useRouter();\n  const toaster = useToast();\n  const { t, te } = useI18n();\n  const userStore = useUserStore();\n  const deviceLimitNewFlow = useRuntimeConfig().public.APP_FLAGS.deviceLimitNewFlow;\n\n  const onSocialLoginError = (error: Error) => {\n    const err = error as Error & { code?: string; token: string; provider: TAuthProvider };\n\n    if (options?.onError) {\n      options.onError(error);\n      return;\n    }\n\n    if (err.code === \"device_limit_exceeded\") {\n      if (deviceLimitNewFlow) {\n        userStore.logout();\n        router.push({ path: \"/auth/login/\", query: { deviceNoLongerAllowedError: \"true\" } });\n      }\n      else {\n        onDeviceLimitError(err.token, err.provider);\n      }\n    }\n    const { message } = getErrorLocalePathMessage(err.message, { t, te });\n    toaster.error(message);\n  };\n  const onSocialLoginSuccess = () => {\n    if (options?.onSuccess)\n      options.onSuccess();\n  };\n\n  const {\n    run: executeSocialLogin,\n    loading: socialLoginLoading,\n  } = useAsync(AuthAPI.signinWithProvider, { onSuccess: onSocialLoginSuccess, onError: onSocialLoginError });\n\n  return {\n    executeSocialLogin,\n    socialLoginLoading,\n  };\n}\n"],"names":["useSSOLogin","options","router","useRouter","toaster","useToast","t","te","useI18n","userStore","useUserStore","deviceLimitNewFlow","useRuntimeConfig","onSocialLoginError","error","err","onDeviceLimitError","message","getErrorLocalePathMessage","onSocialLoginSuccess","executeSocialLogin","socialLoginLoading","useAsync","AuthAPI"],"mappings":"4FAMA,SAAwBA,EAAYC,EAAwE,CAC1G,MAAMC,EAASC,EAAA,EACTC,EAAUC,EAAA,EACV,CAAE,EAAAC,EAAG,GAAAC,CAAA,EAAOC,EAAA,EACZC,EAAYC,EAAA,EACZC,EAAqBC,EAAA,EAAmB,OAAO,UAAU,mBAEzDC,EAAsBC,GAAiB,CAC3C,MAAMC,EAAMD,EAEZ,GAAIb,GAAS,QAAS,CACpBA,EAAQ,QAAQa,CAAK,EACrB,MACF,CAEIC,EAAI,OAAS,0BACXJ,GACFF,EAAU,OAAA,EACVP,EAAO,KAAK,CAAE,KAAM,eAAgB,MAAO,CAAE,2BAA4B,MAAA,EAAU,GAGnFc,EAAmBD,EAAI,MAAOA,EAAI,QAAQ,GAG9C,KAAM,CAAE,QAAAE,GAAYC,EAA0BH,EAAI,QAAS,CAAE,EAAAT,EAAG,GAAAC,EAAI,EACpEH,EAAQ,MAAMa,CAAO,CACvB,EACME,EAAuB,IAAM,CAC7BlB,GAAS,WACXA,EAAQ,UAAA,CACZ,EAEM,CACJ,IAAKmB,EACL,QAASC,CAAA,EACPC,EAASC,EAAQ,mBAAoB,CAAE,UAAWJ,EAAsB,QAASN,EAAoB,EAEzG,MAAO,CACL,mBAAAO,EACA,mBAAAC,CAAA,CAEJ"}