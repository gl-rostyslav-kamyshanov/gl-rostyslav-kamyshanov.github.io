{"version":3,"file":"C4CVOsO_.js","sources":["../../../../app/pages/account/password.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport useAsync from \"~/composables/use-async\";\nimport PasswordAPI from \"~/services/password.js\";\nimport useUserStore from \"~/stores/user\";\nimport getErrorLocalePathMessage from \"~/utils/locale\";\nimport V from \"~/utils/validate\";\n\nconst { t, te } = useI18n();\nconst toaster = useToast();\nconst userStore = useUserStore();\n\nconst formData = reactive({\n  password_old: \"\",\n  password_new: \"\",\n  password_new_repeat: \"\",\n});\n\ntype State = typeof formData;\n\nfunction validate(data: State): IFormError[] {\n  const errs: IFormError[] = [];\n  const state = unref(data);\n\n  if (!V.required(state.password_old)) {\n    errs.push({ path: \"password_old\", message: t(\"errors.field_is_required\") });\n  }\n  else if (!V.min(state.password_old, { length: 8 })) {\n    errs.push({ path: \"password_old\", message: t(\"errors.invalid_password\") });\n  }\n\n  if (!V.required(state.password_new)) {\n    errs.push({ path: \"password_new\", message: t(\"errors.field_is_required\") });\n  }\n  else if (!V.min(state.password_new, { length: 8 })) {\n    errs.push({ path: \"password_new\", message: t(\"errors.invalid_password\") });\n  }\n\n  if (!V.required(state.password_new_repeat)) {\n    errs.push({ path: \"password_new_repeat\", message: t(\"errors.field_is_required\") });\n  }\n  else if (!V.min(state.password_new_repeat, { length: 8 })) {\n    errs.push({ path: \"password_new_repeat\", message: t(\"errors.invalid_password\") });\n  }\n\n  return errs;\n}\n\nconst initialState = JSON.stringify(formData);\nconst stateChanged = computed(() => JSON.stringify(formData) !== initialState);\n\nconst onSuccess = () => {\n  formData.password_new = \"\";\n  formData.password_new_repeat = \"\";\n  formData.password_old = \"\";\n\n  return toaster.success(t(\"pages.account_password.alert_password_update_success\"));\n};\nconst onError = (error: Error) => {\n  const { message } = getErrorLocalePathMessage(error.message, { t, te });\n  return toaster.error(message);\n};\nconst { loading, run: changePassword } = useAsync(PasswordAPI.change, { onSuccess, onError });\n\nasync function onSubmit() {\n  if (formData.password_new !== formData.password_new_repeat) {\n    toaster.error(t(\"errors.passwords_dont_match\"));\n    return;\n  }\n\n  const payload: IRequestPayloadChangePassword = {\n    current_password: formData.password_old,\n    new_password: formData.password_new,\n  };\n\n  return changePassword(payload);\n}\n</script>\n\n<template>\n  <UForm :state=\"formData\" :validate=\"validate\" @submit=\"onSubmit\">\n    <div class=\"flex flex-col gap-6\">\n      <UFormGroup\n        :label=\"t('labels.password_old')\"\n        name=\"password_old\"\n        required\n      >\n        <BaseInput\n          v-model=\"formData.password_old\"\n          :disabled=\"loading\"\n          name=\"password\"\n          :placeholder=\"t('labels.enter_old_password')\"\n          autocomplete=\"new-password\"\n          sensitive\n        >\n          <template #label-suffix>\n            <BaseButton\n              name=\"forgot-password\"\n              class=\"text-caption-medium\"\n              tag=\"nuxt-link\"\n              :to=\"{ path: '/auth/password/forgot/', query: { email: userStore.user?.email } }\"\n              :disabled=\"loading\"\n              link\n            >\n              {{ t('labels.forgot_password') }}?\n            </BaseButton>\n          </template>\n        </BaseInput>\n      </UFormGroup>\n\n      <UFormGroup\n        :label=\"t('labels.password_new')\"\n        name=\"password_new\"\n        required\n      >\n        <BaseInput\n          v-model=\"formData.password_new\"\n          :disabled=\"loading\"\n          :placeholder=\"t('labels.enter_new_password')\"\n          name=\"new-password\"\n          autocomplete=\"new-password\"\n          sensitive\n        />\n      </UFormGroup>\n\n      <UFormGroup\n        :label=\"t('labels.password_repeat')\"\n        name=\"password_new_repeat\"\n        required\n      >\n        <BaseInput\n          v-model=\"formData.password_new_repeat\"\n          :disabled=\"loading\"\n          :placeholder=\"t('labels.confirm_new_password')\"\n          name=\"new-password-confirm\"\n          autocomplete=\"new-password\"\n          sensitive\n        />\n      </UFormGroup>\n    </div>\n\n    <BaseButton\n      class=\"mt-10 font-bold\"\n      name=\"submit-password\"\n      :disabled=\"loading || !stateChanged\"\n      full-width\n    >\n      {{ t('labels.save') }}\n    </BaseButton>\n  </UForm>\n</template>\n"],"names":["t","te","useI18n","toaster","useToast","userStore","useUserStore","formData","reactive","validate","data","errs","state","unref","V","initialState","stateChanged","computed","onSuccess","onError","error","message","getErrorLocalePathMessage","loading","changePassword","useAsync","PasswordAPI","onSubmit","payload","_createBlock","_component_UForm","_unref","_createElementVNode","_hoisted_1","_createVNode","_component_UFormGroup","_component_BaseInput","_cache","$event","_component_BaseButton","_createTextVNode","_toDisplayString"],"mappings":"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"}