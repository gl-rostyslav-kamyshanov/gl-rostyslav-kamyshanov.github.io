{"version":3,"file":"BkDxNCzJ.js","sources":["../../../../app/pages/auth/password/reset.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport useAsync from \"~/composables/use-async\";\nimport PasswordAPI from \"~/services/password\";\nimport getErrorLocalePathMessage from \"~/utils/locale\";\nimport V from \"~/utils/validate\";\n\nconst { t, te } = useI18n();\nconst route = useRoute();\nconst toaster = useToast();\nconst router = useRouter();\nconst token = route.hash.substring(1);\n\nconst formData = reactive({\n  email: (route.query.email as string) || \"\",\n  password_new: \"\",\n  password_new_repeat: \"\",\n  token: token || \"\",\n});\n\ntype State = typeof formData;\n\nfunction validate(data: State): IFormError[] {\n  const errs: IFormError[] = [];\n  const state = unref(data);\n\n  if (!V.required(state.password_new)) {\n    errs.push({ path: \"password_new\", message: t(\"errors.field_is_required\") });\n  }\n  else if (!V.min(state.password_new, { length: 8 })) {\n    errs.push({ path: \"password_new\", message: t(\"errors.invalid_password\") });\n  }\n\n  if (!V.required(state.password_new_repeat)) {\n    errs.push({ path: \"password_new_repeat\", message: t(\"errors.field_is_required\") });\n  }\n  else if (!V.min(state.password_new_repeat, { length: 8 })) {\n    errs.push({ path: \"password_new_repeat\", message: t(\"errors.invalid_password\") });\n  }\n\n  return errs;\n}\n\nconst onSuccess = () =>\n  router.push({\n    name: \"auth-login\",\n    query: { email: formData.email, passwordResetSuccess: \"true\" },\n  });\nconst onError = (error: Error) => {\n  const { message } = getErrorLocalePathMessage(error.message, { t, te });\n  return toaster.error(message);\n};\nconst {\n  loading,\n  run: applyNewPassword,\n} = useAsync(PasswordAPI.applyNew, { onSuccess, onError });\n\nfunction onSubmit() {\n  if (formData.password_new !== formData.password_new_repeat) {\n    return toaster.error(t(\"errors.passwords_dont_match\"));\n  }\n\n  const params = {\n    reset_token: formData.token,\n    new_password: formData.password_new,\n  };\n\n  return applyNewPassword(params);\n}\n\nuseHead({ title: t(\"labels.forgot_password\") });\n</script>\n\n<template>\n  <div>\n    <AuthHeader mode=\"sign-up\" with-locale absolute transparent />\n\n    <BaseMain>\n      <div class=\"pt-32 pb-12 form-column\">\n        <div class=\"w-full max-w-[400px]\">\n          <div class=\"text-center\">\n            <h1 class=\"text-heading-1-bold\">\n              {{ t(\"labels.reset_password\") }}\n            </h1>\n          </div>\n\n          <UForm :state=\"formData\" :validate=\"validate\" class=\"mt-8\" @submit=\"onSubmit\">\n            <div class=\"flex flex-col gap-6\">\n              <UFormGroup\n                :label=\"t('labels.password_new')\"\n                name=\"password_new\"\n                required\n              >\n                <BaseInput\n                  v-model=\"formData.password_new\"\n                  :disabled=\"loading\"\n                  :placeholder=\"t('labels.enter_new_password')\"\n                  name=\"new-password\"\n                  autocomplete=\"new-password\"\n                  sensitive\n                />\n              </UFormGroup>\n              <UFormGroup\n                :label=\"t('labels.password_repeat')\"\n                name=\"password_new_repeat\"\n                required\n              >\n                <BaseInput\n                  v-model=\"formData.password_new_repeat\"\n                  :disabled=\"loading\"\n                  :placeholder=\"t('labels.enter_new_password')\"\n                  name=\"new-password-repeat\"\n                  autocomplete=\"new-password\"\n                  sensitive\n                />\n              </UFormGroup>\n            </div>\n\n            <BaseButton\n              class=\"mt-10 font-bold\"\n              name=\"submit-send-reset-link\"\n              :disabled=\"loading\"\n              full-width\n            >\n              {{ t(\"pages.auth_password.set_new_password\") }}\n            </BaseButton>\n          </UForm>\n        </div>\n      </div>\n    </BaseMain>\n  </div>\n</template>\n"],"names":["t","te","useI18n","route","useRoute","toaster","useToast","router","useRouter","token","formData","reactive","validate","data","errs","state","unref","V","onSuccess","onError","error","message","getErrorLocalePathMessage","loading","applyNewPassword","useAsync","PasswordAPI","onSubmit","params","useHead","_createElementBlock","_createVNode","_component_AuthHeader","_component_BaseMain","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_toDisplayString","_unref","_component_UForm","_hoisted_5","_component_UFormGroup","_component_BaseInput","_cache","$event","_component_BaseButton"],"mappings":"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"}