{"version":3,"file":"CyNJ05yA.js","sources":["../../../../app/components/U/FormGroup/FormGroup.vue","../../../../app/components/U/Form/Form.vue","../../../../app/utils/validate.ts"],"sourcesContent":["<script setup lang=\"ts\">\nimport { twMerge } from \"tailwind-merge\";\n\nconst props = withDefaults(\n  defineProps<{\n    name?: string;\n    label?: string;\n    description?: string;\n    help?: string;\n    hint?: string;\n    error?: string | boolean;\n    required?: boolean;\n    disabled?: boolean;\n    inline?: boolean;\n    containerClass?: string;\n    size?: \"sm\" | \"md\" | \"lg\";\n    icon?: any; // TODO: Add icon type\n  }>(),\n  {\n    error: undefined,\n  },\n);\nconst formErrors = inject<Ref<IFormError[]> | null>(\"form-errors\", null);\n\nconst inputId = computed(() => props.name);\nconst error = computed(() => {\n  return (props.error && typeof props.error === \"string\") || typeof props.error === \"boolean\"\n    ? props.error\n    : formErrors?.value?.find(error => error.path === props.name)?.message;\n});\n\nprovide<IFormGroup>(\"form-group\", {\n  error,\n  name: computed(() => props.name),\n  size: computed(() => props.size),\n  disabled: computed(() => props.disabled),\n});\n</script>\n\n<template>\n  <div\n    class=\"u-form-group\"\n    :class=\"inline && 'u-form-group-inline'\"\n  >\n    <div\n      v-if=\"label && props.icon\"\n      class=\"flex content-center items-center justify-between\"\n    >\n      <label\n        :for=\"inputId\"\n        class=\"flex w-full justify-between\"\n      >\n        <p\n          class=\"u-label-text\" :class=\"[\n            props.required ? 'u-label-text--required' : '',\n            props.disabled ? 'u-label-text--disabled' : '',\n          ]\"\n        >\n          {{ label }}\n        </p>\n      </label>\n\n      <UIcon :name=\"props.icon\" />\n    </div>\n    <div\n      v-else-if=\"label\"\n      class=\"flex content-center items-center justify-between\"\n    >\n      <label :for=\"inputId\">\n        <p\n          class=\"u-label-text\" :class=\"[\n            props.required ? 'u-label-text--required' : '',\n            props.disabled ? 'u-label-text--disabled' : '',\n          ]\"\n        >\n          {{ label }}\n        </p>\n      </label>\n      <span\n        v-if=\"hint\"\n        class=\"u-label-text\"\n      >\n        {{ hint }}\n      </span>\n    </div>\n\n    <p\n      v-if=\"description\"\n      class=\"u-label-text\"\n    >\n      {{ description }}\n    </p>\n\n    <div :class=\"twMerge([label ? inline ? 'relative' : 'mt-2 relative' : '', containerClass])\">\n      <slot v-bind=\"{ error }\" />\n    </div>\n\n    <p\n      v-if=\"error && (typeof error !== 'boolean')\"\n      class=\"u-error-text\"\n    >\n      {{ error }}\n    </p>\n    <p\n      v-if=\"help || $slots.help\"\n      class=\"u-help-text mt-2\"\n    >\n      <slot name=\"help\" />\n      {{ help }}\n    </p>\n  </div>\n</template>\n\n<style lang=\"scss\">\n.u-form-group-inline {\n  @apply inline-flex items-center gap-0;\n  .u-label-text {\n    @apply text-sm;\n  }\n}\n</style>\n","<script lang=\"ts\" generic=\"T extends Object\" setup>\nimport { useEventBus } from \"@vueuse/core\";\n\nclass FormException extends Error {\n  constructor(message: string) {\n    super(message);\n    this.message = message;\n    Object.setPrototypeOf(this, FormException.prototype);\n  }\n}\n\nconst emit = defineEmits<{\n  (event: \"submit\", state: T): void;\n  (event: \"error\", errors: IFormError[]): void;\n}>();\n\nconst props = withDefaults(\n  defineProps<{\n    state: T;\n    validate?: ((state: T) => Promise<IFormError[]>) | ((state: T) => IFormError[]);\n    validateOn?: TFormEventType[];\n  }>(),\n  {\n    validate: () => [],\n    validateOn: () => [\"blur\", \"input\", \"change\", \"submit\"],\n  },\n);\nconst bus = useEventBus<IFormEvent>(\"form-bus\");\n\nbus.on(async (event) => {\n  if (event.type !== \"submit\" && props.validateOn?.includes(event.type)) {\n    await validateForm(event.path, { silent: true });\n  }\n});\n\nconst errors = ref<IFormError[]>([]);\n\nprovide(\"form-errors\", errors);\nprovide(\"form-events\", bus);\n\nasync function getErrors(): Promise<IFormError[]> {\n  const errs = await props.validate(props.state);\n\n  return errs;\n}\n\nasync function validateForm(path?: string, opts: { silent?: boolean } = { silent: false }): Promise<T> {\n  if (path) {\n    const otherErrors = errors.value.filter(error => error.path !== path);\n    const pathErrors = (await getErrors()).filter(error => error.path === path);\n    errors.value = otherErrors.concat(pathErrors);\n  }\n  else {\n    errors.value = await getErrors();\n  }\n\n  if (!opts.silent && errors.value.length > 0) {\n    throw new FormException(`Form validation failed: ${JSON.stringify(errors.value, null, 2)}`);\n  }\n  return props.state;\n}\n\nasync function onSubmit(): Promise<void> {\n  try {\n    if (props.validateOn?.includes(\"submit\"))\n      await validateForm();\n\n    emit(\"submit\", props.state);\n  }\n  catch (error) {\n    if (!(error instanceof FormException)) {\n      throw error;\n    }\n\n    emit(\"error\", errors.value);\n  }\n}\n\ndefineExpose({\n  /**\n   * Triggers form validation. Will raise any errors unless `opts.silent` is set to true.\n   */\n  validate: validateForm,\n  /**\n   * A reference to the array containing validation errors. Use this to access or manipulate the error information.\n   */\n  errors,\n  /**\n   * Sets form errors for a given path. If no path is provided, overrides all errors.\n   */\n  setErrors(errs: IFormError[], path?: string) {\n    errors.value = errs;\n    if (path) {\n      errors.value = errors.value.filter(error => error.path !== path).concat(errs);\n    }\n    else {\n      errors.value = errs;\n    }\n  },\n  /**\n   * Retrieves form errors associated with a specific path. If no path is provided, returns all form errors.\n   */\n  getErrors(path?: string) {\n    if (path)\n      return errors.value.filter(err => err.path === path);\n\n    return errors.value;\n  },\n  /**\n   * Clears form errors associated with a specific path. If no path is provided, clears all form errors.\n   */\n  clear(path?: string) {\n    if (path) {\n      errors.value = errors.value.filter(err => err.path === path);\n    }\n    else {\n      errors.value = [];\n    }\n  },\n} as IForm<T>);\n</script>\n\n<template>\n  <form @submit.prevent=\"onSubmit\">\n    <slot />\n  </form>\n</template>\n","function getSingleParam<TParam = unknown>(params: [TParam] | Record<string, TParam>, paramName: string) {\n  return Array.isArray(params) ? params[0] : params[paramName];\n}\n\nfunction isNullOrUndefined(value: unknown): value is undefined | null {\n  return value === null || value === undefined;\n}\n\nfunction isEmptyArray(arr: unknown): boolean {\n  return Array.isArray(arr) && arr.length === 0;\n}\n\nfunction isEmpty(value: unknown): boolean {\n  if (value === null || value === undefined || value === \"\") {\n    return true;\n  }\n\n  if (Array.isArray(value) && value.length === 0) {\n    return true;\n  }\n\n  return false;\n}\n\nfunction requiredValidator(value: unknown) {\n  if (isNullOrUndefined(value) || isEmptyArray(value) || value === false) {\n    return false;\n  }\n\n  return !!String(value).trim().length;\n}\n\nfunction emailValidator(value: unknown) {\n  if (isEmpty(value)) {\n    return true;\n  }\n\n  const re\n\n      = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\])|(([a-z\\-0-9]+\\.)+[a-z]{2,}))$/i;\n\n  if (Array.isArray(value)) {\n    return value.every(val => re.test(String(val)));\n  }\n\n  return re.test(String(value));\n}\n\nfunction urlValidator(value: unknown) {\n  if (isEmpty(value)) {\n    return true;\n  }\n\n  const re = /^https?:\\/\\/(?:www\\.)?[-\\w@:%.+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b[-\\w()@:%+.~#?&/=]*$/;\n\n  if (Array.isArray(value)) {\n    return value.every(val => re.test(String(val)));\n  }\n\n  return re.test(String(value));\n}\n\nfunction hexColorValidator(value: unknown) {\n  if (isEmpty(value)) {\n    return true;\n  }\n\n  const re = /^#[a-f0-9]{6}$/i;\n\n  return re.test(String(value));\n}\n\nfunction minValidator(value: unknown, params: [string | number] | { length: string | number }): boolean {\n  if (isEmpty(value)) {\n    return true;\n  }\n\n  const length = getSingleParam(params, \"length\");\n  if (Array.isArray(value)) {\n    return value.every(val => minValidator(val, { length }));\n  }\n\n  return [...String(value)].length >= Number(length);\n}\n\nfunction maxValidator(value: unknown, params: [string | number] | { length: string | number }): boolean {\n  if (isEmpty(value)) {\n    return true;\n  }\n\n  const length = getSingleParam(params, \"length\");\n  if (Array.isArray(value)) {\n    return value.every(val => maxValidator(val, { length }));\n  }\n\n  return [...String(value)].length <= Number(length);\n}\n\nfunction phoneValidator(value: unknown): boolean {\n  if (isEmpty(value)) {\n    return true;\n  }\n  const digitsOnly = String(value).replace(/\\D/g, \"\");\n  return /^\\d+$/.test(digitsOnly) && digitsOnly.length >= 4 && digitsOnly.length <= 15;\n}\n\nfunction dateOfBirthValidator(day: string, month: string, year: string): boolean {\n  if (!day || !month || !year) {\n    return false;\n  }\n\n  const currentYear = new Date().getFullYear();\n  const minYear = currentYear - 120;\n\n  const d = Number.parseInt(day);\n  const m = Number.parseInt(month);\n  const y = Number.parseInt(year);\n\n  if (m < 1 || m > 12) {\n    return false;\n  }\n\n  if (d < 1 || d > 31) {\n    return false;\n  }\n\n  if (y < minYear || y > currentYear) {\n    return false;\n  }\n\n  const date = new Date(y, m - 1, d);\n  return date.getFullYear() === y && date.getMonth() === m - 1 && date.getDate() === d;\n}\n\nconst validate = {\n  email: emailValidator,\n  required: requiredValidator,\n  min: minValidator,\n  max: maxValidator,\n  hex: hexColorValidator,\n  url: urlValidator,\n  phone: phoneValidator,\n  dateOfBirth: dateOfBirthValidator,\n};\n\nexport default validate;\n"],"names":["props","__props","formErrors","inject","inputId","computed","error","provide","_createElementBlock","_normalizeClass","inline","label","_openBlock","_hoisted_1","_createElementVNode","_unref","_createVNode","_component_UIcon","_hoisted_3","hint","_hoisted_5","_toDisplayString","description","_hoisted_6","twMerge","containerClass","_renderSlot","_ctx","_hoisted_7","help","$slots","_hoisted_8","_createTextVNode","FormException","message","emit","__emit","bus","useEventBus","event","validateForm","errors","ref","getErrors","path","opts","otherErrors","pathErrors","onSubmit","__expose","errs","err","getSingleParam","params","paramName","isNullOrUndefined","value","isEmptyArray","arr","isEmpty","requiredValidator","emailValidator","re","val","urlValidator","hexColorValidator","minValidator","length","maxValidator","phoneValidator","digitsOnly","dateOfBirthValidator","day","month","year","currentYear","minYear","d","m","y","date","validate"],"mappings":"kvBAGA,MAAMA,EAAQC,EAmBRC,EAAaC,EAAiC,cAAe,IAAI,EAEjEC,EAAUC,EAAS,IAAML,EAAM,IAAI,EACnCM,EAAQD,EAAS,IACbL,EAAM,OAAS,OAAOA,EAAM,OAAU,UAAa,OAAOA,EAAM,OAAU,UAC9EA,EAAM,MACNE,GAAY,OAAO,KAAKI,GAASA,EAAM,OAASN,EAAM,IAAI,GAAG,OAClE,EAED,OAAAO,EAAoB,aAAc,CAChC,MAAAD,EACA,KAAMD,EAAS,IAAML,EAAM,IAAI,EAC/B,KAAMK,EAAS,IAAML,EAAM,IAAI,EAC/B,SAAUK,EAAS,IAAML,EAAM,QAAQ,CAAA,CACxC,+BAICQ,EAsEM,MAAA,CArEJ,MAAKC,EAAA,CAAC,eACEC,EAAAA,QAAM,qBAAA,CAAA,CAAA,GAGNC,EAAAA,OAASX,EAAM,MADvBY,IAAAJ,EAmBM,MAnBNK,EAmBM,CAfJC,EAYQ,QAAA,CAXL,IAAKC,EAAAX,CAAA,EACN,MAAM,6BAAA,GAENU,EAOI,IAAA,CANF,SAAM,eAAc,CAAuBd,EAAM,SAAQ,yBAAA,GAA8CA,EAAM,SAAQ,yBAAA,EAAA,OAKlHW,EAAAA,KAAK,EAAA,CAAA,CAAA,OAIZK,EAA4BC,EAAA,CAApB,KAAMjB,EAAM,IAAA,sBAGTW,EAAAA,OADbC,IAAAJ,EAoBM,MApBNU,EAoBM,CAhBJJ,EASQ,QAAA,CATA,IAAKC,EAAAX,CAAA,GAAO,CAClBU,EAOI,IAAA,CANF,SAAM,eAAc,CAAuBd,EAAM,SAAQ,yBAAA,GAA8CA,EAAM,SAAQ,yBAAA,EAAA,OAKlHW,EAAAA,KAAK,EAAA,CAAA,CAAA,OAIJQ,EAAAA,UADRX,EAKO,OALPY,EAKOC,EADFF,EAAAA,IAAI,EAAA,CAAA,wBAKHG,EAAAA,iBADRd,EAKI,IALJe,EAKIF,EADCC,EAAAA,WAAW,EAAA,CAAA,YAGhBR,EAEM,MAAA,CAFA,QAAOC,EAAAS,CAAA,EAAO,CAAEb,QAAQD,EAAAA,qCAA4Ce,EAAAA,cAAc,CAAA,CAAA,CAAA,GACtFC,EAA2BC,8BAAXZ,EAAAT,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,KAIfS,EAAAT,CAAA,UAAiBS,EAAAT,CAAA,GAAK,eAD9BE,EAKI,IALJoB,EAKIP,EADCN,EAAAT,CAAA,CAAK,EAAA,CAAA,YAGFuB,EAAAA,MAAQC,EAAAA,OAAO,MADvBlB,IAAAJ,EAMI,IANJuB,EAMI,CAFFL,EAAoBC,EAAA,OAAA,MAAA,EAAAK,EAAA,MACjBH,EAAAA,IAAI,EAAA,CAAA,CAAA,2PCzGb,MAAMI,UAAsB,KAAM,CAChC,YAAYC,EAAiB,CAC3B,MAAMA,CAAO,EACb,KAAK,QAAUA,EACf,OAAO,eAAe,KAAMD,EAAc,SAAS,CACrD,CAAA,CAGF,MAAME,EAAOC,EAKPpC,EAAQC,EAWRoC,EAAMC,EAAwB,UAAU,EAE9CD,EAAI,GAAG,MAAOE,GAAU,CAClBA,EAAM,OAAS,UAAYvC,EAAM,YAAY,SAASuC,EAAM,IAAI,GAClE,MAAMC,EAAaD,EAAM,KAAM,CAAE,OAAQ,GAAM,CAEnD,CAAC,EAED,MAAME,EAASC,EAAkB,EAAE,EAEnCnC,EAAQ,cAAekC,CAAM,EAC7BlC,EAAQ,cAAe8B,CAAG,EAE1B,eAAeM,GAAmC,CAGhD,OAFa,MAAM3C,EAAM,SAASA,EAAM,KAAK,CAG/C,CAEA,eAAewC,EAAaI,EAAeC,EAA6B,CAAE,OAAQ,IAAqB,CACrG,GAAID,EAAM,CACR,MAAME,EAAcL,EAAO,MAAM,OAAOnC,GAASA,EAAM,OAASsC,CAAI,EAC9DG,GAAc,MAAMJ,KAAa,OAAOrC,GAASA,EAAM,OAASsC,CAAI,EAC1EH,EAAO,MAAQK,EAAY,OAAOC,CAAU,CAC9C,MAEEN,EAAO,MAAQ,MAAME,EAAA,EAGvB,GAAI,CAACE,EAAK,QAAUJ,EAAO,MAAM,OAAS,EACxC,MAAM,IAAIR,EAAc,2BAA2B,KAAK,UAAUQ,EAAO,MAAO,KAAM,CAAC,CAAC,EAAE,EAE5F,OAAOzC,EAAM,KACf,CAEA,eAAegD,GAA0B,CACvC,GAAI,CACEhD,EAAM,YAAY,SAAS,QAAQ,GACrC,MAAMwC,EAAA,EAERL,EAAK,SAAUnC,EAAM,KAAK,CAC5B,OACOM,EAAO,CACZ,GAAI,EAAEA,aAAiB2B,GACrB,MAAM3B,EAGR6B,EAAK,QAASM,EAAO,KAAK,CAC5B,CACF,CAEA,OAAAQ,EAAa,CAIX,SAAUT,EAIV,OAAAC,EAIA,UAAUS,EAAoBN,EAAe,CAC3CH,EAAO,MAAQS,EACXN,EACFH,EAAO,MAAQA,EAAO,MAAM,OAAOnC,GAASA,EAAM,OAASsC,CAAI,EAAE,OAAOM,CAAI,EAG5ET,EAAO,MAAQS,CAEnB,EAIA,UAAUN,EAAe,CACvB,OAAIA,EACKH,EAAO,MAAM,OAAOU,GAAOA,EAAI,OAASP,CAAI,EAE9CH,EAAO,KAChB,EAIA,MAAMG,EAAe,CACfA,EACFH,EAAO,MAAQA,EAAO,MAAM,OAAOU,GAAOA,EAAI,OAASP,CAAI,EAG3DH,EAAO,MAAQ,CAAA,CAEnB,CAAA,CACW,cAIXjC,EAEO,OAAA,CAFA,WAAgBwC,EAAQ,CAAA,SAAA,CAAA,CAAA,GAC7BtB,EAAQC,EAAA,OAAA,SAAA,CAAA,+CC5HZ,SAASyB,EAAiCC,EAA2CC,EAAmB,CACtG,OAAO,MAAM,QAAQD,CAAM,EAAIA,EAAO,CAAC,EAAIA,EAAOC,CAAS,CAC7D,CAEA,SAASC,EAAkBC,EAA2C,CACpE,OAAOA,GAAU,IACnB,CAEA,SAASC,EAAaC,EAAuB,CAC3C,OAAO,MAAM,QAAQA,CAAG,GAAKA,EAAI,SAAW,CAC9C,CAEA,SAASC,EAAQH,EAAyB,CAKxC,MAJI,GAAAA,GAAU,MAA+BA,IAAU,IAInD,MAAM,QAAQA,CAAK,GAAKA,EAAM,SAAW,EAK/C,CAEA,SAASI,EAAkBJ,EAAgB,CACzC,OAAID,EAAkBC,CAAK,GAAKC,EAAaD,CAAK,GAAKA,IAAU,GACxD,GAGF,CAAC,CAAC,OAAOA,CAAK,EAAE,OAAO,MAChC,CAEA,SAASK,GAAeL,EAAgB,CACtC,GAAIG,EAAQH,CAAK,EACf,MAAO,GAGT,MAAMM,EAEA,uIAEN,OAAI,MAAM,QAAQN,CAAK,EACdA,EAAM,MAAMO,GAAOD,EAAG,KAAK,OAAOC,CAAG,CAAC,CAAC,EAGzCD,EAAG,KAAK,OAAON,CAAK,CAAC,CAC9B,CAEA,SAASQ,GAAaR,EAAgB,CACpC,GAAIG,EAAQH,CAAK,EACf,MAAO,GAGT,MAAMM,EAAK,uFAEX,OAAI,MAAM,QAAQN,CAAK,EACdA,EAAM,MAAMO,GAAOD,EAAG,KAAK,OAAOC,CAAG,CAAC,CAAC,EAGzCD,EAAG,KAAK,OAAON,CAAK,CAAC,CAC9B,CAEA,SAASS,GAAkBT,EAAgB,CACzC,OAAIG,EAAQH,CAAK,EACR,GAGE,kBAED,KAAK,OAAOA,CAAK,CAAC,CAC9B,CAEA,SAASU,EAAaV,EAAgBH,EAAkE,CACtG,GAAIM,EAAQH,CAAK,EACf,MAAO,GAGT,MAAMW,EAASf,EAAeC,EAAQ,QAAQ,EAC9C,OAAI,MAAM,QAAQG,CAAK,EACdA,EAAM,MAAMO,GAAOG,EAAaH,EAAK,CAAE,OAAAI,CAAA,CAAQ,CAAC,EAGlD,CAAC,GAAG,OAAOX,CAAK,CAAC,EAAE,QAAU,OAAOW,CAAM,CACnD,CAEA,SAASC,EAAaZ,EAAgBH,EAAkE,CACtG,GAAIM,EAAQH,CAAK,EACf,MAAO,GAGT,MAAMW,EAASf,EAAeC,EAAQ,QAAQ,EAC9C,OAAI,MAAM,QAAQG,CAAK,EACdA,EAAM,MAAMO,GAAOK,EAAaL,EAAK,CAAE,OAAAI,CAAA,CAAQ,CAAC,EAGlD,CAAC,GAAG,OAAOX,CAAK,CAAC,EAAE,QAAU,OAAOW,CAAM,CACnD,CAEA,SAASE,GAAeb,EAAyB,CAC/C,GAAIG,EAAQH,CAAK,EACf,MAAO,GAET,MAAMc,EAAa,OAAOd,CAAK,EAAE,QAAQ,MAAO,EAAE,EAClD,MAAO,QAAQ,KAAKc,CAAU,GAAKA,EAAW,QAAU,GAAKA,EAAW,QAAU,EACpF,CAEA,SAASC,GAAqBC,EAAaC,EAAeC,EAAuB,CAC/E,GAAI,CAACF,GAAO,CAACC,GAAS,CAACC,EACrB,MAAO,GAGT,MAAMC,EAAc,IAAI,KAAA,EAAO,YAAA,EACzBC,EAAUD,EAAc,IAExBE,EAAI,OAAO,SAASL,CAAG,EACvBM,EAAI,OAAO,SAASL,CAAK,EACzBM,EAAI,OAAO,SAASL,CAAI,EAU9B,GARII,EAAI,GAAKA,EAAI,IAIbD,EAAI,GAAKA,EAAI,IAIbE,EAAIH,GAAWG,EAAIJ,EACrB,MAAO,GAGT,MAAMK,EAAO,IAAI,KAAKD,EAAGD,EAAI,EAAGD,CAAC,EACjC,OAAOG,EAAK,gBAAkBD,GAAKC,EAAK,aAAeF,EAAI,GAAKE,EAAK,QAAA,IAAcH,CACrF,CAEA,MAAMI,GAAW,CACf,MAAOpB,GACP,SAAUD,EACV,IAAKM,EACL,IAAKE,EACL,IAAKH,GACL,IAAKD,GACL,MAAOK,GACP,YAAaE,EACf"}