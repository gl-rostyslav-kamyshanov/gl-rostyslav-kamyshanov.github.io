import{v as n,bj as y,bk as p,b as c,a1 as l}from"./DerHuaWG.js";import{f as m}from"./BW4JKS41.js";import{g}from"./Ct4CBNX9.js";const i=e=>{const r=e.expireMonth&&e.expireYear?`${e.expireMonth}/${String(e.expireYear).substring(2)}`:"";return{id:e.id??"",cardHolderName:e.displayName??"",cardNumber:e.number??"",cardExpiration:r,cardCVV:"",cardType:e.type}},P=e=>{const[r,t]=e.cardExpiration.split("/");return{cardNumber:e.cardNumber.replace(/\s+/g,""),cardholderName:e.cardHolderName,cardExpirationMonth:r,cardExpirationYear:t,securityCode:e.cardCVV}},h=e=>({id:e._id,title:e.title,description:e.description,price:e.price,currency:e.currency||"N/A",startDate:e.startDate,endDate:e.endDate,isActive:e.active,autoRenew:e.autoRenew,type:e.type,originalProductId:e.originalProductId,lastPayment:e.lastPayment||0}),f=e=>{const r=o=>m(o,"d.L.yyyy"),t=g(e.price,e.currency);return{id:e.details.orderId,date:r(e.date),name:e.title,type:e.details.productType,amount:t}},u=e=>{const r=c();r.creditCard=e},d={load(){const e=c();if(e.creditCard)return Promise.resolve(e.creditCard);const{request:r}=n();return r.get("/api/payment/user_method_info").then(t=>Object.keys(t.content).length!==0?(e.creditCard=i(t.content),i(t.content)):null)},loadHistory(e){const{request:r}=n();return r.get("/api/commerce/billing_history",{query:e}).then(t=>l(t,f))},update(e){const{request:r}=n(),t={card:{token:e}};return r.post("/api/commerce/set_billing_info",{body:t}).then(o=>u(i(o.content)))},delete(){const{request:e}=n(),r=c(),t={card_id:r.creditCard?.id,user_id:r.user?.id};return e.post("/api/payment/delete_method",{body:t}).then(()=>u(null))},redeemAccessCode(e){const{request:r}=n();return r.post("/api/commerce/redeem_code",{body:{code:e}}).then(t=>h(t.content))},purchase(e){const{request:r}=n();return r.post("/api/payment/purchase",{body:e})},async createMercadoPagoCardToken(e){const r=p(),t=c(),o=r.$mercadopago;try{const a=await o?.createCardToken(e);if(!a)throw new Error("ERR400GN00");return t.creditCardToken=a.id,a.id}catch(a){throw new Error(a.message)}},async updateMercadoPagoCardToken(e){const r=p(),t=c(),o=r.$mercadopago;try{const a=await o?.updateCardToken(e);if(!a)throw new Error("ERR400GN00");return t.creditCardToken=a.id,a.id}catch(a){throw new Error(a.message)}},async payWithMercadoPagoWithUpdatedToken(e,r){try{const t=await d.updateMercadoPagoCardToken(r);await d.purchase({productId:e,token:t})}catch(t){throw new Error(t.message)}},async payWithMercadoPagoCreditCard(e,r){try{const t=await d.createMercadoPagoCardToken(r);await d.purchase({productId:e,token:t})}catch(t){throw new Error(t.message)}},initPayment(e,r,t="en"){const{request:o}=n(),a={productId:e,callbackUrl:r,language:t};return o.post("/api/payment/initialize",{body:a}).then(s=>(y.set(`transactionId_${e}`,s.content.transactionId,{expires:new Date(new Date().getTime()+5*60*1e3),sameSite:"strict"}),s.content.authorizationUrl)).then(s=>{window.location.href=s})},verifyTransaction(e){const{request:r}=n(),t={transactionId:e};return r.post("/api/payment/verify",{body:t})},confirmProcessingPayment(e){const{request:r}=n(),t={transactionId:e};return r.post("/api/payment/confirm_processing",{body:t})}};export{d as B,P as f};
