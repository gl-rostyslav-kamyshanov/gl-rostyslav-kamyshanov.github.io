import{_ as ee,a as se}from"./DbmCVbSw.js";import{d as te,u as oe,M as ae,P as re,b as ne,K as ie,N as le,e as U,ay as $,f as q,q as D,aM as ue,o as de,g as ce,c as A,a as d,h as o,j as e,w as i,i as l,t as c,F as k,z as L,s as N,a6 as me,_ as pe,m as S,av as _e,az as ge,by as fe,bz as he,aN as we}from"./DerHuaWG.js";import{_ as xe}from"./CHbtWh_f.js";import{a as be,_ as ve,v as h}from"./BitiqTgw.js";import{_ as ye}from"./xLaX2kiZ.js";import{_ as qe}from"./Bpg6rltn.js";import"./DDXf38dI.js";import"./B1Dwy9Zh.js";import"./B1WgeY6J.js";import"./BbQEIO2R.js";import"./CXmLEB7Q.js";import"./CpW5mb9k.js";import"./DR87jf0Q.js";import"./BQ4KkwTu.js";import"./Dy0jkx8y.js";import"./DuOXD_T7.js";import"./BnaPSCuZ.js";import"./0iIPzPE5.js";import"./Cq_Brx5T.js";import"./BL4y2nel.js";import"./nhaelfjx.js";import"./zusbJOjZ.js";import"./BaQOmWNP.js";import"./BwIGFgv7.js";import"./I8tIaOjO.js";const Ae=E=>new Promise(s=>setTimeout(s,E)),ke={class:"flex flex-col items-center justify-center h-screen sm:pt-0 px-4 sm:px-0"},Le={class:"w-full max-w-[25rem]"},Ne={class:"whitespace-pre-wrap text-heading-1-bold text-center sm:text-left"},Se={class:"mt-4 text-caption-medium text-secondary"},Ee={class:"mt-4 text-caption-medium text-secondary text-center sm:text-left"},Pe={class:"flex flex-col gap-2 sm:gap-6"},Be={class:"mt-2 flex flex-col gap-8"},as=te({__name:"index",setup(E){const{t:s,te:P}=oe(),a=ae(),m=re(),G=ne(),B=ie().public,r=le({username:a.query.email||"",password:""});function H(n){const t=[],u=e(n);return h.required(u.username)?h.email(u.username)||t.push({path:"username",message:s("errors.invalid_email")}):t.push({path:"username",message:s("errors.field_is_required")}),h.required(u.password)?h.min(u.password,{length:8})||t.push({path:"password",message:s("errors.invalid_password")}):t.push({path:"password",message:s("errors.field_is_required")}),t}const w=B.APP_FLAGS.hasIfaAuth,z=B.APP_FLAGS.deviceLimitNewFlow,F=async()=>{if(w){window.location.href="/";return}m.push(a.query.redirectUrl||"/")},I=n=>{const t=n;t.code==="device_limit_exceeded"&&(z?(G.logout(),m.push({path:"/auth/login/",query:{deviceNoLongerAllowedError:"true"}})):ge(t.token,t.provider,{username:r.username,password:r.password}))},{loading:O,error:x,run:j}=U($.signin,{onSuccess:F,onError:I}),{loading:p,error:V,run:b}=U($.signinWithProvider,{onSuccess:F,onError:I}),_=q(()=>O.value||p.value),C=()=>((a.query.sessionExpired||a.query.deviceNoLongerAllowedError)&&m.replace({query:{...a.query,sessionExpired:void 0,deviceNoLongerAllowedError:void 0}}),j(r.username,r.password,fe.SIGN_IN));async function J(){await Ae(5e3),a.query.passwordResetSuccess&&m.push({query:{...a.query,passwordResetSuccess:void 0}})}async function K(){if(a.query.data)try{const n=JSON.parse(he(a.query.data));n.provider==="credentials"?(r.username=n.username,r.password=n.password,C()):b(n.provider)}catch(n){x.value=n&&n.message}}const g=q(()=>a.query.deviceNoLongerAllowedError?s("pages.auth_login.device_no_longer_allowed_error"):a.query.sessionExpired?s("errors.expired_session_error"):x.value?D(x.value,{t:s,te:P}).message:V.value?D(V.value,{t:s,te:P}).message:null),M=ue(we).greaterOrEqual("sm");return de(()=>{J(),K()}),ce({title:q(()=>s("labels.sign_in"))}),(n,t)=>{const u=ee,v=me,W=_e,y=pe,R=xe,T=ve,Q=be,X=ye,Y=qe,Z=se;return d(),A(k,null,[o(u,{mode:e(w)?void 0:"sign-up",fixed:!e(M),absolute:e(M),transparent:"",class:"my-2 sm:my-0","with-locale":""},null,8,["mode","fixed","absolute"]),o(Z,null,{default:i(()=>[l("div",ke,[l("div",Le,[l("h1",Ne,c(e(s)("pages.auth_sign_in.welcome_message")),1),e(w)?(d(),A(k,{key:0},[l("p",Se,c(e(s)("pages.auth_sign_in.sign_in_with_provider",{provider:"IFA"})),1),e(g)?(d(),L(v,{key:0,type:"danger",class:"mt-6",text:e(g)},null,8,["text"])):N("",!0),o(y,{style:{"--base-primary-accent-color":"#2c374b"},class:"relative mt-8 text-button-bold",name:"ifa","full-width":"",disabled:e(p),onClick:t[0]||(t[0]=f=>e(b)("ifa"))},{default:i(()=>[o(W,{class:"absolute top-2.5 left-3",src:"/images/icons/icon-ifa-logo.webp","fallback-src":"/images/mock/logo.svg",alt:"Logo",width:24,height:24}),S(" "+c(e(s)("labels.continue_with",{provider:"IFA"})),1)]),_:1},8,["disabled"])],64)):(d(),A(k,{key:1},[l("p",Ee,c(e(s)("pages.auth_sign_up.enter_your_details_below")),1),e(g)?(d(),L(v,{key:0,type:"danger",class:"mt-6",text:e(g)},null,8,["text"])):N("",!0),e(a).query.passwordResetSuccess?(d(),L(v,{key:1,type:"success",class:"mt-6",text:e(s)("pages.auth_sign_up.password_updated_successuly_text")},null,8,["text"])):N("",!0),o(Q,{state:e(r),validate:H,class:"mt-8",onSubmit:C},{default:i(()=>[l("div",Pe,[o(T,{label:e(s)("labels.email"),name:"username",required:""},{default:i(()=>[o(R,{modelValue:e(r).username,"onUpdate:modelValue":t[1]||(t[1]=f=>e(r).username=f),disabled:e(_),name:"email",placeholder:e(s)("labels.email_placeholder"),autocomplete:"email"},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),o(T,{label:e(s)("labels.password"),required:"",name:"password"},{default:i(()=>[o(R,{modelValue:e(r).password,"onUpdate:modelValue":t[2]||(t[2]=f=>e(r).password=f),disabled:e(_),placeholder:e(s)("labels.min_8_characters"),name:"password",autocomplete:"new-password",sensitive:""},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),l("div",Be,[o(y,{name:"forgot-password",tag:"nuxt-link",class:"text-sm",to:{path:"/auth/password/forgot/",query:{email:e(r).username}},disabled:e(_),link:""},{default:i(()=>[S(c(e(s)("labels.forgot_password"))+"? ",1)]),_:1},8,["to","disabled"]),o(y,{class:"font-bold",name:"submit-login",disabled:e(_)||e(p),"full-width":""},{default:i(()=>[S(c(e(s)("labels.sign_in")),1)]),_:1},8,["disabled"])])]),_:1},8,["state"]),o(X,{disabled:e(p),onClickProvider:e(b)},null,8,["disabled","onClickProvider"])],64))]),o(Y,{class:"text-center"})])]),_:1})],64)}}});export{as as default};
