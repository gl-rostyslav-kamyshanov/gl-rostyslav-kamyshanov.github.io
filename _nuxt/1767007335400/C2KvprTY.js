import{a as ne,b as oe,c as se,_ as re}from"./K0FOolKr.js";import{u as G,_ as ee,o as le,a as ce,i as de,b as O,B as ue}from"./vfF7RKPo.js";import{g as X,d as Y}from"./C_PxQ261.js";import{d as H,g as p,o as d,h as i,i as x,v as l,Y as e,s as S,N as M,K as W,X as te,W as me,f as y,e as ae,k as R,b as D,aj as pe,H as ie,ad as z,c as J,F as Q}from"./DrHYGv5w.js";import{_ as _e}from"./DowbGgKV.js";import{_ as be}from"./CBJd-9r4.js";import{u as fe,B as Z}from"./mCVtpy1_.js";const ye={class:"flex items-center justify-between mb-4"},ge={class:"text-secondary text-body-medium"},he={key:0,class:"text-secondary text-base font-medium uppercase"},ve={class:"flex items-center justify-between"},xe={class:"text-main text-base font-bold"},Ce={key:0,class:"text-main text-base font-bold uppercase"},Ne={class:"mb-6 text-xs text-secondary"},Ie=H({__name:"SubscriptionBuyDetails",props:{price:{},currency:{},expirationDate:{}},setup(T){const _=T,{t:n}=G();return(u,f)=>(d(),p("div",null,[f[0]||(f[0]=i("div",{class:"hr my-6"},null,-1)),i("div",ye,[i("div",ge,l(e(n)("pages.account_subscription.label_plan_amount")),1),_.price&&_.currency?(d(),p("div",he,l(e(X)(_.price,_.currency)),1)):x("",!0)]),i("div",ve,[i("div",xe,l(e(n)("pages.account_subscription.label_total_billed")),1),_.price&&_.currency?(d(),p("div",Ce,l(e(X)(_.price,_.currency)),1)):x("",!0)]),f[1]||(f[1]=i("div",{class:"hr my-6"},null,-1)),i("div",Ne,l(_.expirationDate),1)]))}}),ke=Object.assign(Ie,{__name:"AccountSubscriptionBuyDetails"}),we={class:"flex mb-2"},Se={class:"baseInput mb-2"},Be={class:"inline-block transition text-secondary text-caption-medium mb-2 after:content-['*'] after:text-[#d22018] after:mx-[2px]"},Pe={key:0,class:"baseInput__errorMessage text-caption-medium"},$e={class:"flex gap-6 mb-2"},Fe={class:"baseInput w-full"},Me={class:"inline-block transition text-secondary text-caption-medium mb-2 after:content-['*'] after:text-[#d22018] after:mx-[2px]"},Te={key:0,class:"baseInput__errorMessage text-caption-medium"},Ve={class:"baseInput w-full"},De={class:"inline-block transition text-secondary text-caption-medium mb-2 after:content-['*'] after:text-[#d22018] after:mx-[2px]"},Ee={key:0,class:"baseInput__errorMessage text-caption-medium"},Ae={key:0,class:"space-y-2 pt-2"},Le={key:1,class:"baseIdentificationInput mb-2"},Ue={class:"mb-2"},je={id:"input-label-identificationType",class:"inline-block text-secondary text-caption-medium transition after:content-['*'] after:text-[#d22018] after:mx-[2px]"},qe={class:"baseInputGroup"},Oe=["onClick"],Re={class:"font-medium text-sm text-secondary"},We={key:0,class:"baseInput__errorMessage text-caption-medium"},ze=H({__name:"MercadopagoFields",props:{disabled:{type:Boolean},submitLabel:{},outline:{type:Boolean},amount:{}},emits:["submit","error"],setup(T,{emit:_}){const{t:n}=G(),{mercadopago:u,isAvailable:f}=fe(),k=_,b=T,C=S([]),V=S(!1),c=S(null),g=S(!1),r=S({cardholderName:"",identificationType:"",identificationNumber:""}),o=S({cardNumber:{complete:!1,error:""},expirationDate:{complete:!1,error:""},securityCode:{complete:!1,error:""},identificationNumber:{complete:!1,error:""}});let w=null,B=null,P=null;const $=M(()=>C.value.length>0),A=M(()=>{const t=o.value.cardNumber.complete&&o.value.expirationDate.complete&&o.value.securityCode.complete&&r.value.cardholderName.trim()!=="";return $.value?t&&o.value.identificationNumber.complete&&r.value.identificationType!==""&&r.value.identificationNumber.trim()!=="":t}),h=(t,a,s="")=>{o.value[t]={complete:a,error:s}},L=async()=>{if(u.value)try{V.value=!0;const t=await u.value.getIdentificationTypes();C.value=(t||[]).map(a=>({id:a.id,name:a.name,value:a.id,title:a.name,min_length:a.min_length,max_length:a.max_length}))}catch{C.value=[]}finally{V.value=!1}},N=()=>{const t=r.value.identificationNumber.trim();if(!t){h("identificationNumber",!1,"");return}if(!c.value){h("identificationNumber",!1,n("errors.field_is_required"));return}const{min_length:a,max_length:s}=c.value,m=t.length;if(a&&m<a){h("identificationNumber",!1,n("pages.account_billing.mercadopago_errors.identification_number_min_length",{min:a}));return}if(s&&m>s){h("identificationNumber",!1,n("pages.account_billing.mercadopago_errors.identification_number_max_length",{max:s}));return}h("identificationNumber",!0,"")};W(c,t=>{t&&(r.value.identificationType=t.id,N())}),W(()=>r.value.identificationNumber,N);const U=()=>{const t=getComputedStyle(document.documentElement),a=t.getPropertyValue("--base-text-color").trim(),s=t.getPropertyValue("--base-secondary-color").trim();return{color:a||"#26282b",fontFamily:"'Red Hat Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",fontSize:"16px",fontWeight:"500",placeholderColor:s||"#8f959f",height:"20px",padding:"0"}},j=async()=>{if(!u.value||!f.value){k("error",new Error("MercadoPago not available"));return}try{const t=U();w=u.value.fields.create("cardNumber",{style:t}),w.mount("mercadopago-card-number"),B=u.value.fields.create("expirationDate",{style:t}),B.mount("mercadopago-expiration-date"),P=u.value.fields.create("securityCode",{style:t}),P.mount("mercadopago-security-code");const a=s=>m=>{const F=!m.errorMessages?.length;let I="";if(m.errorMessages?.length){const v=`pages.account_billing.mercadopago_errors.${m.errorMessages[0].cause||"default"}`;I=n(v),I===v&&(I=n("pages.account_billing.mercadopago_errors.default"))}h(s,F,I)};w.on("validityChange",a("cardNumber")),B.on("validityChange",a("expirationDate")),P.on("validityChange",a("securityCode"))}catch(t){k("error",t)}},q=async t=>{if(t.preventDefault(),!(g.value||!u.value)){if(!r.value.cardholderName){k("error",new Error("Please fill all required fields"));return}if($.value&&(!r.value.identificationType||!r.value.identificationNumber)){k("error",new Error("Please fill all required fields"));return}try{g.value=!0;const a={cardholderName:r.value.cardholderName};$.value&&(a.identificationType=r.value.identificationType,a.identificationNumber=r.value.identificationNumber);const s=await u.value.fields.createCardToken(a,void 0);k("submit",{token:s?.id||""})}catch(a){Array.isArray(a)&&a.forEach(s=>{if(s.field&&s.message){const m=s.field;o.value[m]!==void 0&&h(m,!1,s.message)}}),k("error",a)}finally{g.value=!1}}};return te(async()=>{await L(),await j()}),me(()=>{w?.unmount(),B?.unmount(),P?.unmount()}),(t,a)=>{const s=ne,m=oe,F=se,I=_e,E=be,K=ee;return d(),p("form",{onSubmit:q},[i("div",we,[y(s),y(m,{class:"mx-3"}),y(F)]),y(I,{modelValue:e(r).cardholderName,"onUpdate:modelValue":a[0]||(a[0]=v=>e(r).cardholderName=v),outline:b.outline,disabled:b.disabled||e(g),label:e(n)("pages.account_billing.card_holder_name"),"root-class":"mb-2",name:"cardholderName",autocomplete:"cc-name",required:""},null,8,["modelValue","outline","disabled","label"]),i("div",Se,[i("label",Be,l(e(n)("pages.account_billing.card_number")),1),i("div",{id:"mercadopago-card-number",class:R(["baseInput__inner",{baseInput__field_outline:b.outline,baseInput__field_hasError:!!e(o).cardNumber.error}])},null,2),e(o).cardNumber.error?(d(),p("div",Pe,l(e(o).cardNumber.error),1)):x("",!0)]),i("div",$e,[i("div",Fe,[i("label",Me,l(e(n)("pages.account_billing.card_expiry_date")),1),i("div",{id:"mercadopago-expiration-date",class:R(["baseInput__inner",{baseInput__field_outline:b.outline,baseInput__field_hasError:!!e(o).expirationDate.error}])},null,2),e(o).expirationDate.error?(d(),p("div",Te,l(e(o).expirationDate.error),1)):x("",!0)]),i("div",Ve,[i("label",De,l(e(n)("pages.account_billing.card_cvv")),1),i("div",{id:"mercadopago-security-code",class:R(["baseInput__inner",{baseInput__field_outline:b.outline,baseInput__field_hasError:!!e(o).securityCode.error}])},null,2),e(o).securityCode.error?(d(),p("div",Ee,l(e(o).securityCode.error),1)):x("",!0)])]),e(V)?(d(),p("div",Ae,[...a[3]||(a[3]=[i("div",{class:"skeletonLoading h-4 w-32"},null,-1),i("div",{class:"skeletonLoading h-10 w-full"},null,-1)])])):e($)?(d(),p("div",Le,[i("div",Ue,[i("label",je,l(e(n)("pages.account_billing.identification_type")),1)]),i("div",qe,[y(E,{modelValue:e(c),"onUpdate:modelValue":a[1]||(a[1]=v=>ie(c)?c.value=v:null),disabled:b.disabled||e(g),outline:b.outline,options:e(C),required:!0,name:"identificationType","aria-labelledby":"input-label-identificationType","options-key-value":"value","options-key-title":"title","has-search":"","search-placeholder":e(n)("labels.search"),"has-empty-input":""},{innerInputPrefix:D(({toggle:v})=>[i("div",{class:"baseIdentificationInput__innerType",onClick:pe(Je=>v(),["prevent"])},[i("span",Re,l(e(c)?.id||""),1)],8,Oe)]),_:1},8,["modelValue","disabled","outline","options","search-placeholder"]),y(I,{modelValue:e(r).identificationNumber,"onUpdate:modelValue":a[2]||(a[2]=v=>e(r).identificationNumber=v),disabled:b.disabled||e(g),outline:b.outline,"root-class":"baseIdentificationInput__number",name:"identificationNumber","aria-labelledby":"input-label-identificationType",placeholder:e(n)("pages.account_billing.identification_number_placeholder"),minlength:e(c)?.min_length,maxlength:e(c)?.max_length,required:""},null,8,["modelValue","disabled","outline","placeholder","minlength","maxlength"])]),e(o).identificationNumber.error?(d(),p("div",We,l(e(o).identificationNumber.error),1)):x("",!0)])):x("",!0),ae(t.$slots,"before-submit",{},void 0,!0),y(K,{class:"font-bold",name:"submit",disabled:b.disabled||e(g)||!e(f)||!e(A),"full-width":""},{default:D(()=>[z(l(e(g)?e(n)("labels.loading"):b.submitLabel||e(n)("labels.save")),1)]),_:1},8,["disabled"])],32)}}}),Ge=Object.assign(le(ze,[["__scopeId","data-v-fbc9b434"]]),{__name:"BillingFormMercadopagoFields"}),He={class:"mt-6"},Ke={class:"my-6"},Xe={key:1,class:"text-body-medium text-secondary"},Ye=H({__name:"index",props:{outline:{type:Boolean},subscription:{}},emits:["success","error","loading","submit"],setup(T,{emit:_}){const n=T,u=_,{t:f}=G(),k=ce(),b=de().public,C=M(()=>k.creditCard),V=b.APP_FLAGS.hasMercadoPagoPayment,c=S(!0),{loading:g,run:r}=O(()=>Z.load()),o=()=>u("success"),w=t=>u("error",t),{loading:B,run:P}=O(()=>ue.subscribeWithOwnCreditCard(n.subscription.id),{onSuccess:o,onError:w}),{loading:$,run:A}=O(t=>(u("submit",t),Z.purchase({productId:n.subscription.id,token:t.token})),{onSuccess:o,onError:w}),h=M(()=>C.value&&c.value),L=M(()=>!C.value||!c.value),N=M(()=>g.value||B.value||$.value),U=t=>{A(t)},j=t=>{w(t)},q=()=>{c.value=!1};return te(()=>{r()}),W(N,t=>u("loading",t)),(t,a)=>{const s=re,m=ee,F=ke,I=Ge;return d(),p("div",He,[e(C)?(d(),p(Q,{key:0},[y(s,{"has-radio-active":e(c),"onUpdate:hasRadioActive":a[0]||(a[0]=E=>ie(c)?c.value=E:null),"has-radio":"",card:e(C),disabled:e(N)},null,8,["has-radio-active","card","disabled"]),i("div",Ke,[e(h)?(d(),J(m,{key:0,disabled:e(N),class:"text-main text-button-bold",type:"secondary",name:"billing-switch-to-new-card",onClick:q},{default:D(()=>[z(l(e(f)("button.enter_another_card")),1)]),_:1},8,["disabled"])):(d(),p("div",Xe,l(e(f)("button.enter_another_card")),1))])],64)):x("",!0),e(h)?(d(),p(Q,{key:1},[y(F,{price:t.subscription.price,currency:t.subscription.currency,"expiration-date":e(Y)(t.subscription)},null,8,["price","currency","expiration-date"]),y(m,{class:"font-bold",name:"submit-existing-card","full-width":"",disabled:e(N),onClick:e(P)},{default:D(()=>[z(l(e(f)("labels.purchase")),1)]),_:1},8,["disabled","onClick"])],64)):x("",!0),e(L)&&e(V)?(d(),J(I,{key:2,amount:t.subscription.price,"submit-label":e(f)("labels.purchase"),outline:t.outline,disabled:e(N),onSubmit:U,onError:j},{"before-submit":D(()=>[y(F,{price:t.subscription.price,currency:t.subscription.currency,"expiration-date":e(Y)(t.subscription)},null,8,["price","currency","expiration-date"])]),_:1},8,["amount","submit-label","outline","disabled"])):x("",!0),ae(t.$slots,"cancel",{disabled:e(N)})])}}}),ot=Object.assign(Ye,{__name:"BillingForm"});export{ot as _};
