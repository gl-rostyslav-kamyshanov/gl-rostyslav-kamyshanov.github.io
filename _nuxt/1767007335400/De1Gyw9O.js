import{_ as Z,a as ee}from"./CZgr-xsV.js";import{u as se,k as te,l as oe,a as ae,i as re,b as U,Y as $,g as M,a2 as ne,c as ie,v as le,_ as ue,W as de,aJ as ce,a3 as me}from"./vfF7RKPo.js";import{_ as pe}from"./DowbGgKV.js";import{a as _e,_ as ge,v as h}from"./V8NEB3vv.js";import{_ as fe}from"./CfVSTXe_.js";import{_ as he}from"./CUhCmOFv.js";import{b as xe}from"./DammSZ-d.js";import{d as we,B as be,N as q,X as ve,g as k,o as d,f as o,Y as e,b as i,h as l,v as c,F as A,c as S,i as B,ad as E}from"./DrHYGv5w.js";import"./YXvYJOkl.js";import"./qTb77THm.js";import"./6tYJEWcP.js";import"./B4wo3SUq.js";import"./DJO5Ko8d.js";import"./d1rVCiWV.js";import"./Dql7-ge0.js";import"./xeMFU3jQ.js";import"./B-DBQphj.js";import"./CeLpXuE_.js";import"./B47pBCHT.js";import"./DsilW_8g.js";import"./CuVeKCNu.js";import"./DjtFQFjx.js";import"./DdW31oNs.js";import"./CFdcWqxl.js";import"./B1IlCmgd.js";import"./BmvnMvdl.js";import"./DNaFeO-P.js";import"./IVvJIK5b.js";import"./Dq-QN952.js";import"./BP16HqTF.js";const ye=L=>new Promise(s=>setTimeout(s,L)),qe={class:"flex flex-col items-center justify-center h-screen sm:pt-0 px-4 sm:px-0"},ke={class:"w-full max-w-[25rem]"},Ae={class:"whitespace-pre-wrap text-heading-1-bold text-center sm:text-left"},Se={class:"mt-4 text-caption-medium text-secondary"},Be={class:"mt-4 text-caption-medium text-secondary text-center sm:text-left"},Ee={class:"flex flex-col gap-2 sm:gap-6"},Le={class:"mt-2 flex flex-col gap-8"},is=we({__name:"index",setup(L){const{t:s,te:N}=se(),a=te(),m=oe(),H=ae(),D=re().public,n=be({username:a.query.email||"",password:""});function G(r){const t=[],u=e(r);return h.required(u.username)?h.email(u.username)||t.push({path:"username",message:s("errors.invalid_email")}):t.push({path:"username",message:s("errors.field_is_required")}),h.required(u.password)?h.min(u.password,{length:8})||t.push({path:"password",message:s("errors.invalid_password")}):t.push({path:"password",message:s("errors.field_is_required")}),t}const x=D.APP_FLAGS.hasIfaAuth,I=async()=>{if(x){window.location.href="/";return}m.push(a.query.redirectUrl||"/")},P=r=>{r.code==="device_limit_exceeded"&&(H.logout(),m.push({path:"/auth/login/",query:{deviceNoLongerAllowedError:"true"}}))},{loading:O,error:w,run:J}=U($.signin,{onSuccess:I,onError:P}),{loading:p,error:V,run:b}=U($.signinWithProvider,{onSuccess:I,onError:P}),_=q(()=>O.value||p.value),C=()=>((a.query.sessionExpired||a.query.deviceNoLongerAllowedError)&&m.replace({query:{...a.query,sessionExpired:void 0,deviceNoLongerAllowedError:void 0}}),J(n.username,n.password,ce.SIGN_IN));async function W(){await ye(5e3),a.query.passwordResetSuccess&&m.push({query:{...a.query,passwordResetSuccess:void 0}})}async function Y(){if(a.query.data)try{const r=JSON.parse(xe(a.query.data));r.provider==="credentials"?(n.username=r.username,n.password=r.password,C()):b(r.provider)}catch(r){w.value=r&&r.message}}const g=q(()=>a.query.deviceNoLongerAllowedError?s("pages.auth_login.device_no_longer_allowed_error"):a.query.sessionExpired?s("errors.expired_session_error"):w.value?M(w.value,{t:s,te:N}).message:V.value?M(V.value,{t:s,te:N}).message:null),F=ne(me).greaterOrEqual("sm");return ve(()=>{W(),Y()}),ie({title:q(()=>s("labels.sign_in"))}),(r,t)=>{const u=Z,v=le,j=de,y=ue,R=pe,T=ge,X=_e,z=fe,K=he,Q=ee;return d(),k(A,null,[o(u,{mode:e(x)?void 0:"sign-up",fixed:!e(F),absolute:e(F),transparent:"",class:"my-2 sm:my-0","with-locale":""},null,8,["mode","fixed","absolute"]),o(Q,null,{default:i(()=>[l("div",qe,[l("div",ke,[l("h1",Ae,c(e(s)("pages.auth_sign_in.welcome_message")),1),e(x)?(d(),k(A,{key:0},[l("p",Se,c(e(s)("pages.auth_sign_in.sign_in_with_provider",{provider:"IFA"})),1),e(g)?(d(),S(v,{key:0,type:"danger",class:"mt-6",text:e(g)},null,8,["text"])):B("",!0),o(y,{style:{"--base-primary-accent-color":"#2c374b"},class:"relative mt-8 text-button-bold",name:"ifa","full-width":"",disabled:e(p),onClick:t[0]||(t[0]=f=>e(b)("ifa"))},{default:i(()=>[o(j,{class:"absolute top-2.5 left-3",src:"/images/icons/icon-ifa-logo.webp","fallback-src":"/images/mock/logo.svg",alt:"Logo",width:24,height:24}),E(" "+c(e(s)("labels.continue_with",{provider:"IFA"})),1)]),_:1},8,["disabled"])],64)):(d(),k(A,{key:1},[l("p",Be,c(e(s)("pages.auth_sign_up.enter_your_details_below")),1),e(g)?(d(),S(v,{key:0,type:"danger",class:"mt-6",text:e(g)},null,8,["text"])):B("",!0),e(a).query.passwordResetSuccess?(d(),S(v,{key:1,type:"success",class:"mt-6",text:e(s)("pages.auth_sign_up.password_updated_successuly_text")},null,8,["text"])):B("",!0),o(X,{state:e(n),validate:G,class:"mt-8",onSubmit:C},{default:i(()=>[l("div",Ee,[o(T,{label:e(s)("labels.email"),name:"username",required:""},{default:i(()=>[o(R,{modelValue:e(n).username,"onUpdate:modelValue":t[1]||(t[1]=f=>e(n).username=f),disabled:e(_),name:"email",placeholder:e(s)("labels.email_placeholder"),autocomplete:"email"},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),o(T,{label:e(s)("labels.password"),required:"",name:"password"},{default:i(()=>[o(R,{modelValue:e(n).password,"onUpdate:modelValue":t[2]||(t[2]=f=>e(n).password=f),disabled:e(_),placeholder:e(s)("labels.min_8_characters"),name:"password",autocomplete:"new-password",sensitive:""},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),l("div",Le,[o(y,{name:"forgot-password",tag:"nuxt-link",class:"text-sm",to:{path:"/auth/password/forgot/",query:{email:e(n).username}},disabled:e(_),link:""},{default:i(()=>[E(c(e(s)("labels.forgot_password"))+"? ",1)]),_:1},8,["to","disabled"]),o(y,{class:"font-bold",name:"submit-login",disabled:e(_)||e(p),"full-width":""},{default:i(()=>[E(c(e(s)("labels.sign_in")),1)]),_:1},8,["disabled"])])]),_:1},8,["state"]),o(z,{disabled:e(p),onClickProvider:e(b)},null,8,["disabled","onClickProvider"])],64))]),o(K,{class:"text-center"})])]),_:1})],64)}}});export{is as default};
