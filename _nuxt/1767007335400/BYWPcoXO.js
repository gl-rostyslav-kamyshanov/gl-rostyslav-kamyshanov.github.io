import{u as b,k as y,l as k,a as A,g as E,v as S,b1 as z,b2 as B,Y as N,b3 as R}from"./vfF7RKPo.js";import{d as I,s as m,N as M,X as C,g as f,o as i,i as h,c as O,Y as c,h as P}from"./DrHYGv5w.js";import"./IVvJIK5b.js";import"./Dql7-ge0.js";const q={class:"main-container text-main flex justify-center items-center gap-4"},L={key:0,class:"inline-block h-8 w-8 animate-spin rounded-full border-2 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},U=I({__name:"[provider]",setup(T){const{t:_,te:w}=b(),u=y(),d=k(),v=A(),l=u.query.code,r=u.params.provider,t=m(null),n=m(!1),p=M(()=>t.value&&E(t.value.message,{t:_,te:w}).message),s=e=>{window.opener&&window.opener.postMessage(e,window.opener.location)},a=e=>{if(!window.opener){e.code&&e.code==="device_limit_exceeded"&&(v.logout(),d.push({path:"/auth/login/",query:{deviceNoLongerAllowedError:"true"}})),t.value=e;return}s({error:JSON.stringify(e)})},g=e=>{if(R(e,r),!window.opener){d.push("/");return}s({success:!0})};return C(async()=>{if(n.value=!0,!l||!r){const e=new Error("Invalid authorization code or provider");a(e);return}try{const{access_token:e}=await z(l);if(window.opener){s({access_token:e});return}const o=B(e,r);N.signSSO(o).then(g).catch(a)}catch(e){a(e)}finally{n.value=!1}}),(e,o)=>{const x=S;return i(),f("div",q,[c(n)?(i(),f("div",L,[...o[0]||(o[0]=[P("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},null,-1)])])):h("",!0),c(p)?(i(),O(x,{key:1,type:"danger",text:c(p)},null,8,["text"])):h("",!0)])}}});export{U as default};
