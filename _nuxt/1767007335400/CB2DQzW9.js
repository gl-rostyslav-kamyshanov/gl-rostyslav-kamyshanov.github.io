import{f as P}from"./vfF7RKPo.js";import{s,X as p,K as x,N as g,a7 as u}from"./DrHYGv5w.js";function D(a){const t=s(0),e=s([]),r=s([]),c=s(null),n=s(!1),i=a.pageSize||10,v=s(!1);function I(){if(t.value+=1,a.paginateExistItems){h();return}d()}function h(){n.value=!0,e.value=e.value.concat(r.value.slice(t.value*i,i*(t.value+1))),r.value.length<=e.value.length&&(v.value=!1),n.value=!1}function d(){return n.value=!0,c.value=null,a.loadItemsFn(t.value,i).then(o=>{r.value=o.content.entries,e.value=a.paginateExistItems?r.value.slice(0,i):e.value.concat(o.content.entries),v.value=o.content.nextExists||(a.paginateExistItems?e.value.length<o.content.entryCount:!1),n.value=!1,a.onItemsLoadedFn&&a.onItemsLoadedFn(e.value)}).catch(o=>{c.value=o.message,n.value=!1})}function m(){t.value=0,e.value=[],Array.isArray(a.preloadedItems)&&(e.value=e.value.concat(a.preloadedItems)),d()}return p(()=>a.immediate&&m()),{page:t,reset:m,loadMore:I,items:e,loading:n,error:c,canLoadMore:v}}function S(a){const t=s(0),e=s([]),r=a.pageSize||10,c=s(null),{state:n,error:i,isLoading:v,refetch:I}=P({key:()=>[...a.queryKey,"page",t.value,"size",r],query:async()=>await a.loadItemsFn(t.value,r),placeholderData:l=>l,staleTime:a.staleTime,autoRefetch:a.autoRefetch});x(i,l=>{l?c.value=l.message||String(l):c.value=null},{immediate:!0});const h=g(()=>n.value?.data?.content?.entries||[]),d=g(()=>n.value?.data?.content?.nextExists||!1),m=g(()=>n.value?.data?.content?.totalCount||0),o=g(()=>n.value?.data?.content?.count||0);x(()=>n.value,l=>{if(l?.data&&!i.value){if(t.value===0)e.value=[...l.data.content.entries];else{const f=new Set(e.value.map(y=>y.id)),F=l.data.content.entries.filter(y=>!f.has(y.id));e.value=[...e.value,...F]}a.onItemsLoadedFn&&a.onItemsLoadedFn(e.value)}},{immediate:!0});function L(){d.value&&!v.value&&(t.value+=1)}function M(){t.value=0,e.value=[],I()}function C(){const l=t.value;e.value=[],t.value=0;for(let f=0;f<=l;f++)t.value=f}return{items:e,currentPageData:u(h),page:u(t),isLoading:u(v),loading:u(v),error:u(c),hasMore:u(d),canLoadMore:u(d),totalCount:u(m),currentCount:u(o),loadMore:L,reset:M,refresh:C}}export{D as a,S as u};
