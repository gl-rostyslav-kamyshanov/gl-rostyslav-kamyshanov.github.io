import{d as x,u as y,M as k,P as S,b as z,r as m,f as E,q as R,K as L,o as N,c as f,a as i,s as w,z as P,j as c,i as B,a6 as M,bQ as C,bR as F,az as I,aA as q,bS as O}from"./CMXPbp7C.js";const j={class:"main-container text-main flex justify-center items-center gap-4"},T={key:0,class:"inline-block h-8 w-8 animate-spin rounded-full border-2 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",role:"status"},J=x({__name:"[provider]",setup(V){const{t:h,te:_}=y(),u=k(),d=S(),v=z(),l=u.query.code,t=u.params.provider,r=m(null),n=m(!1),p=E(()=>r.value&&R(r.value.message,{t:h,te:_}).message),g=L().public.APP_FLAGS.deviceLimitNewFlow,s=e=>{window.opener&&window.opener.postMessage(e,window.opener.location)},a=e=>{if(!window.opener){e.code&&e.code==="device_limit_exceeded"&&(g?(v.logout(),d.push({path:"/auth/login/",query:{deviceNoLongerAllowedError:"true"}})):q(e.token,e.provider)),r.value=e;return}s({error:JSON.stringify(e)})},b=e=>{if(O(e,t),!window.opener){d.push("/");return}s({success:!0})};return N(async()=>{if(n.value=!0,!l||!t){const e=new Error("Invalid authorization code or provider");a(e);return}try{const{access_token:e}=await C(l);if(window.opener){s({access_token:e});return}const o=F(e,t);I.signSSO(o).then(b).catch(a)}catch(e){a(e)}finally{n.value=!1}}),(e,o)=>{const A=M;return i(),f("div",j,[c(n)?(i(),f("div",T,o[0]||(o[0]=[B("span",{class:"!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"},null,-1)]))):w("",!0),c(p)?(i(),P(A,{key:1,type:"danger",text:c(p)},null,8,["text"])):w("",!0)])}}});export{J as default};
