import{a as z,b as G,c as J,d as Q,_ as X}from"./Dyy8MfMJ.js";import{d as M,u as O,c as C,a as c,i as d,s as g,t as _,j as e,r as A,f as F,k as Z,h as m,T as W,w as $,z as N,m as I,_ as K,b as ee,K as te,e as U,ae,O as ne,l as H,F as oe}from"./CMXPbp7C.js";import{g as L,d as q}from"./Cw0F3zGg.js";import{_ as se}from"./DS0G5IEo.js";import{_ as re}from"./B3Kb2PV6.js";import{B as ie,f as le}from"./xsw4Ry_I.js";const ce={class:"flex items-center justify-between mb-4"},de={class:"text-secondary text-body-medium"},ue={key:0,class:"text-secondary text-base font-medium uppercase"},me={class:"flex items-center justify-between"},pe={class:"text-main text-base font-bold"},_e={key:0,class:"text-main text-base font-bold uppercase"},be={class:"mb-6 text-xs text-secondary"},ye=M({__name:"SubscriptionBuyDetails",props:{price:{},currency:{},expirationDate:{}},setup(h){const l=h,{t:i}=O();return(k,n)=>(c(),C("div",null,[n[0]||(n[0]=d("div",{class:"hr my-6"},null,-1)),d("div",ce,[d("div",de,_(e(i)("pages.account_subscription.label_plan_amount")),1),l.price&&l.currency?(c(),C("div",ue,_(e(L)(l.price,l.currency)),1)):g("",!0)]),d("div",me,[d("div",pe,_(e(i)("pages.account_subscription.label_total_billed")),1),l.price&&l.currency?(c(),C("div",_e,_(e(L)(l.price,l.currency)),1)):g("",!0)]),n[1]||(n[1]=d("div",{class:"hr my-6"},null,-1)),d("div",be,_(l.expirationDate),1)]))}}),xe=Object.assign(ye,{__name:"AccountSubscriptionBuyDetails"}),fe={class:"flex mb-6"},ge={class:"flex gap-6 mb-8"},Ce=M({__name:"Fields",props:{cardHolderName:{},cardNumber:{},cardExpiration:{},cardType:{},disabled:{type:Boolean},submitLabel:{},outline:{type:Boolean}},emits:["submit"],setup(h,{emit:l}){const{t:i}=O(),k=l,n=h,a=A({cardHolderName:n.cardHolderName||"",cardNumber:n.cardNumber||"",cardExpiration:n.cardExpiration||"",cardCVV:"",cardType:n.cardType||""}),y={visa:/^4/,mastercard:/^5[1-5]/,amex:/^3(4|7)/,discover:/^6011/},V={digit_15:"[0-9]{4}( )[0-9]{6}( )[0-9]{5}",digit_16:"([0-9]{4}( )){3}[0-9]{4}"},w=()=>k("submit",a.value),T=s=>{if(s){for(const t in y)if(y[t].test(s))return t}},B=s=>{let t=s.split(" ").join("");const{cardType:f}=a.value;if(!s.length)return t;let r;return f==="amex"?(r=t.match(/^(\d{1,4})(\d{1,6})?(\d{1,5})?/),r&&(t=r.slice(1).filter(Boolean).join(" ").replace(/\D/g," ")),t):(r=t.match(/.{1,4}/g),r&&(t=r.join(" ").replace(/\D/g," ")),t)},x=s=>{let t=s.split(" ").join("");const f=t.match(/^(\d{2})(\d{2})/);return t.length&&f&&(t=t.replace(/^(\d{2})(\d{2})/,"$1/$2")),t},b=F(()=>{const{cardType:s}=a.value;return s==="amex"?V.digit_15:V.digit_16}),S=()=>{a.value.cardNumber=B(a.value.cardNumber)},E=()=>{a.value.cardExpiration=x(a.value.cardExpiration)},D=s=>a.value.cardType=T(s);return(s,t)=>{const f=z,r=G,p=J,o=re,j=Q,P=K;return c(),C("form",{onSubmit:t[4]||(t[4]=Z(u=>w(),["prevent"]))},[d("div",fe,[m(f),m(r,{class:"mx-3"}),m(p)]),m(o,{modelValue:e(a).cardHolderName,"onUpdate:modelValue":t[0]||(t[0]=u=>e(a).cardHolderName=u),outline:n.outline,disabled:n.disabled,label:e(i)("pages.account_billing.card_holder_name"),"root-class":"mb-6",name:"cardName",required:""},null,8,["modelValue","outline","disabled","label"]),m(o,{modelValue:e(a).cardNumber,"onUpdate:modelValue":[t[1]||(t[1]=u=>e(a).cardNumber=u),D],outline:n.outline,disabled:n.disabled,label:e(i)("pages.account_billing.card_number"),"root-class":"mb-6",name:"cardNumber",autocomplete:"cc-number",placeholder:"0000 0000 0000 0000",pattern:e(b),maxlength:"19",required:"",onKeyup:S},{suffix:$(()=>[e(a).cardType?(c(),N(j,{key:0,type:e(a).cardType},null,8,["type"])):g("",!0)]),_:1},8,["modelValue","outline","disabled","label","pattern"]),d("div",ge,[m(o,{modelValue:e(a).cardExpiration,"onUpdate:modelValue":t[2]||(t[2]=u=>e(a).cardExpiration=u),outline:n.outline,disabled:n.disabled,label:e(i)("pages.account_billing.card_expiry_date"),"root-class":"w-full",name:"cardExpiry",placeholder:"MM / YY",pattern:"(0[1-9]|1[0-2])\\/?([0-9]{4}|[2-9]{2})",maxlength:"5",required:"",onKeyup:E},null,8,["modelValue","outline","disabled","label"]),m(o,{modelValue:e(a).cardCVV,"onUpdate:modelValue":t[3]||(t[3]=u=>e(a).cardCVV=u),disabled:n.disabled,label:e(i)("pages.account_billing.card_cvv"),"root-class":"w-full",name:"cardCVV",outline:n.outline,autocomplete:"cc-csc",placeholder:"3 or 4 digits",pattern:"^[0-9]{3,4}$",maxlength:"4",sensitive:"",required:""},null,8,["modelValue","disabled","label","outline"])]),W(s.$slots,"before-submit"),m(P,{class:"font-bold",name:"submit",disabled:n.disabled,"full-width":""},{default:$(()=>[I(_(n.submitLabel||e(i)("labels.save")),1)]),_:1},8,["disabled"])],32)}}}),ve=Object.assign(Ce,{__name:"BillingFormFields"}),he={class:"mt-6"},Ve={class:"my-6"},Be={key:1,class:"text-body-medium text-secondary"},Ne=M({__name:"index",props:{outline:{type:Boolean},subscription:{}},emits:["success","error","loading","submit"],setup(h,{emit:l}){const{t:i}=O(),k=ee(),n=te().public,a=h,y=l,V=()=>y("success"),w=p=>y("error",p),T=()=>y("loading"),B=A(!1),x=F(()=>k.creditCard),b=A(!!x.value),S=n.APP_FLAGS.hasMercadoPagoPayment,{loading:E,run:D}=U(()=>ae.subscribeWithOwnCreditCard(a.subscription.id),{onSuccess:V,onError:w}),{loading:s,run:t}=U(p=>{const o=ie.payWithMercadoPagoCreditCard;return y("submit",p),o(a.subscription.id,p)},{onSuccess:V,onError:w}),f=p=>{const o=le(p);return t(o)},r=F(()=>E.value||s.value);return ne(r,T),(p,o)=>{const j=X,P=K,u=xe,R=se,Y=ve;return c(),C("div",he,[d("div",null,[e(x)?(c(),N(j,{key:0,"has-radio-active":e(b),"onUpdate:hasRadioActive":o[0]||(o[0]=v=>H(b)?b.value=v:null),"has-radio":"",card:e(x),disabled:e(r)},null,8,["has-radio-active","card","disabled"])):g("",!0),d("div",Ve,[e(b)?(c(),N(P,{key:0,disabled:e(r),class:"text-main text-button-bold",type:"secondary",name:"billing-tab",onClick:o[1]||(o[1]=v=>b.value=!1)},{default:$(()=>[I(_(e(i)("button.enter_another_card")),1)]),_:1},8,["disabled"])):e(x)?(c(),C("div",Be,_(e(i)("button.enter_another_card")),1)):g("",!0)]),e(b)?(c(),C(oe,{key:1},[m(u,{price:a.subscription?.price,currency:a.subscription?.currency,"expiration-date":e(q)(a.subscription)},null,8,["price","currency","expiration-date"]),m(P,{class:"font-bold",name:"submit","full-width":"",disabled:e(r),onClick:e(D)},{default:$(()=>[I(_(e(i)("labels.purchase")),1)]),_:1},8,["disabled","onClick"])],64)):e(S)?(c(),N(Y,{key:2,"submit-label":e(i)("labels.purchase"),outline:a.outline,disabled:e(r),onSubmit:o[3]||(o[3]=v=>f(v))},{"before-submit":$(()=>[d("div",null,[e(x)?(c(),N(R,{key:0,modelValue:e(B),"onUpdate:modelValue":o[2]||(o[2]=v=>H(B)?B.value=v:null),name:"save-card",label:e(i)("pages.account_subscription.checkbox_apply_as_new_credit_card"),class:"text-main"},null,8,["modelValue","label"])):g("",!0),m(u,{price:a.subscription?.price,currency:a.subscription?.currency,"expiration-date":e(q)(a.subscription)},null,8,["price","currency","expiration-date"])])]),_:1},8,["submit-label","outline","disabled"])):g("",!0),W(p.$slots,"cancel",{disabled:e(r)})])])}}}),Ee=Object.assign(Ne,{__name:"BillingForm"});export{Ee as _};
